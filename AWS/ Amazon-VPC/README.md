[Doc1](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/what-is-amazon-vpc.html)
[Doc2](https://aws.amazon.com/ko/vpc/pricing/)

# Amazon VPC
- VPC (Virtual Private Cloud)는 클라우드 환경을 퍼블릭, 프라이빗의 논리적으로 독립된 네트워크 영역으로 분리하게 해줌.
- 논리적으로 분리된 영역에 격리할 수 있으며, 사용자가 네트워크 환경 설정에 대한 통제권을 가실 수 있음.
- 사용자가 Amazon VPC를 통해 만든 네트워크에서 자체 IP 주소, 퍼블릭, 프라이빗 서브넷, 라우트 테이블, 네트워크 게이트웨이 등 모든 기능을 활용할 수 있음.

### 활용 예시
- 애플리케이션 중 일부는 VPC 내 클라우드에서 실행, 일부는 온프레미스에서 실행.
- VPC 내에서 인터넷의 접근을 허용하는 퍼블릭 서브넷, 한정된 접근을 허용하는 프라이빗 서브넷 생성 가능.
- Direct Connect를 이용해 기업 데이터 센터와 VPN을 전용 회선으로 연결 할 수 있음.
- 하나 이상의 VPC가 필요하다면 다수의 VPC를 생성한 후 VPC 피어링을 통해 서로 연결 가능.

### Amazon VPC 구성요소 - 서브넷
![subnet](../images/VPC.png "subnet")<br>

- 서브네트워크(subnetwork)의 줄임말로 IP 네트워크의 논리적인 영역을 부분적으로 나눈 하위 망을 말함.
- 서브넷을 통해 네트워크 분리 가능.

VPC(10.0.0.0/16) 내에 퍼블릭 서브넷, 프라이빗 서브넷
- VPC애에 서브넷을 통해 네트워크망을 분리
- VPC의 IP 대역인 10.0.0.0/16, 퍼블릭 서브넷, 프라이빗 서브넷의 IP 대역 10.0.0.0/24, 10.0.1.0/24

- VPC의 IP 대역을 10.0.0.0/16의 설정은 prefix가 /16이므로 앞의 10.0이 네트워크 주소를의미, 나머지 16bit로 호스트 주소를 정할 수 있다는 의미
  - 10.0.0.0 ~ 10.0.255.255 IP 범위가 같은 네트워크에 속한다는 의미
- 퍼블릭 서브넷의 IP 대역을 10.0.0.0/24로 설정시 24bit(10.0.0.)를 네트워크 주소로 사용하겠다는 의미, 나머지 8bit를 사용해서 호수트 주소를 정할 수 있다는 의미.
  - 10.0.0.0 ~ 10.0.0.255 IP 범위가 같은 퍼블릭 서브넷에 속한다는 의미
- 프라이빗 서브넷의 IP 대역을 10.0.1.0/24로 설정시 24bit(10.0.1.)를 네트워크 주소로 사용하겠다는 의미, 나머지 8bit를 사용해서 호수트 주소를 정할 수 있다는 의미.
  - 10.0.1.0 ~ 10.0.1.255 IP 범위가 같은 프라이 서브넷에 속한다는 의미

- 서브넷 IP 대역은 VPC의 IP 대역에 속해 있어야 하고, 서브넷은 1개의 가용 영역(AZ)에 종속되어야 함.
- AWS에서는 서브넷에 할당할 수 있는 IP 대역에서 미리 예약되어 있는 IP주소가 있는데 이런 예약된 IP 주소들은 AWS자원에 할당할 수 없음.

### AWS에서 서브넷 IP 대역마다 예약된 IP 주소
- 서브넷 IP 대역에서 1 ~ 4번째, 마지막 IP 주소는 예약이 되어 있음.
- ex) VPC의 IP 대역이 10.0.0.0/16, 해당 VPC에 존재하는 서브넷에 할당된 IP 대역이 10.0.0.0/24면 서브넷의 IP 대역은 10.0.0.0 ~ 10.0.0.255.
- 1번째 주소 : 10.0.0.0 -> 네트워크 주소
- 2번째 주소 : 10.0.0.1 -> AWS VPC 가상 라우터 주소
- 3번째 주소 : 10.0.0.2 -> AWS DNS 서버 주소
  - DNS 서버의 IP 주소는 해당 VPC의 IP 범위에 2를 더한 주소. CIDR 블록이 여러 개인 VPC (서브넷을 가지고 있는 VPC의 경우)<br>
    DNS 서버의 IP주소를 제외하고도 각 서브넷 IP 대역 범위에 2를 더한 모든 주소가 예약되어 있음.
- 4번째 주소 : 10.0.0.3 -> 향후 새로운 기능에 활용할 주소
- 마지막 주소 : 10.0.0.255 -> 네트워크 브로드캐스트 주소

### 퍼블릭 서브넷, 프라이빗 서브넷
- 퍼블릭 서브넷 : 공인 네트워크 개념. 외부 인터넷 구간과 직접적으로 통신을 할 수 있는 공공 네트워크.
- 프라이빗 서브넷 : 사설 네트워크 개념. 외부 인터넷 구간과 직접적인 통신을 할 수 없는 폐쇄적인 네트어ㅜ크 망.
- VPC 이용시 [퍼블릭 서브넷, 프라이빗 서브넷, VPN only 서브넷]등 필요에 따라 다양한 서브넷 생성 가능.
  - 퍼블릭 서브넷 : 인터넷을 통해 연결할 수 있는 리소스를 배치하기 위한 네트워크
  - 프라이빗 서브넷 : 인터넷으로 연결하지 않고 보안 유지를 위한 배타적인 연결에 사용되는 네트워크
  - VPN Only 서브넷 : 기업의 데이터 센터와 VPC를 연결하는 데 사용되는 네트워크
- ex) 3티어 구조시 웹은 퍼블릭 서브넷, DB 티어는 프라이빗 서브넷에 위치가 적합.


### Amazon VPC 구성요소 - 가상 라우터와 라우트 테이블
- VPC를 생성하면 자동으로 가상 라우터가 생성.
- 이 가상 라우터는 라우트 테이블을 가지고 있는데, 라우트 테이블은 트래픽의 전송 방향을 결정하는 라우트와 관련된 규칙을 담는 테이블
- 목적지를 향한 최적의 경로로 데이터 패킷을 전송하기 위한 모든 정보를 담고 있음.
- 가상 라우터: 최초에 기본 라우트 테이블을 보유. 로컬 네트워크에 대한 라우트 경로만 설정되어 있음.
- 로컬 네트워크 : VPC의 자체 IP 대역. VPC 내에 생성된 서브넷은 라우트 테이블의 로컬 네트워크에 의해 통신 가능.
- 가상 라우터에서는 서브넷별로 라우트 테이블을 생성하고 매핑하여 서브넷 당 개별적인 라우트 테이블을 가질 수 있음.

#### 퍼블릭 서브넷 매핑 라우트 테이블
- Destination(10.0.0.0/16)은 10.0.0.0 ~ 10.0.0.255.255 까지의 트래픽을 Target(local)로 보내고 다른 모든 대역들(0.0.0.0/0, ::/0)의 트래픽은
  Target(Internet Gate Way)로 보내라는 정보가 저장되어 있음.
- 만약 10.0.0.1 안에 서버에서 10.0.0.2로 트래픽을 보내면, 라우트 테이블을 거쳐 로컬로 보내지게 됨.

#### 프라이빗 서브넷 매핑 라우트 테이블
- 프라이빗 서브넷이 매핑된 라우트 테이블은 인터넷 게이트웨이(IGW) 설정이 없기 때문에, 해당 서브넷과 연결된 서버로는 인터넷에 접근할 수 없다.
- Destination(10.0.0.0/16) 10.0.0.0 ~ 10.0.255.255 까지의 트래픽을 Target(local)로 보내는 것은 동일.
<br>
![Routetable](../images/Routetable.png "Routetable")<br>
- VPC(10.0.0.0/16)을 퍼블릭 서브넷(10.0.0.0/24), 프라이빗 서브넷(10.0.1.0/24)로 나누고 각각 라우트 테이블을 생성해 매핑한 표.
- 퍼블릭 라우트 테이블은 10.0.0.0/16의 트래픽만 로컬로 보내주는 설정 뿐.
- 때문에 퍼블릭 서브넷에 위치한 서버가 인터넷으로 트래픽을 보낼 수 없는 구조.
- 여기서, 인터넷에 연결하기 위해서는 인터넷 게이트웨이(IGW)가 필요 함.


### Amazon VPC 구성요소 - 인터넷 게이트웨이 (IGW)

